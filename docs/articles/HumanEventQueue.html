<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Human Event Queue • MASH</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">MASH</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/smitdave/MASH">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Human Event Queue</h1>
                        <h4 class="author">Sean Wu</h4>
            
            <h4 class="date">2017-06-21</h4>
          </div>

    
    
<div class="contents">
<div id="event-queue" class="section level1">
<h1 class="hasAnchor">
<a href="#event-queue" class="anchor"></a>Event Queue</h1>
<p>The event queue is a crucial part of the MASH framework as it handles all events a human could preform. It follows a generic structure that any extensions of MASH should mirror exactly. When extensions are added they must include at a minimum functions of the form <code>add2Q_XX(), event_XX(), XX()</code> for events to be properly called. Descriptions and examples follow.</p>
<div id="event-queue-management" class="section level2">
<h2 class="hasAnchor">
<a href="#event-queue-management" class="anchor"></a>Event Queue Management</h2>
<div id="addevent2q" class="section level3">
<h3 class="hasAnchor">
<a href="#addevent2q" class="anchor"></a>addEvent2Q</h3>
<p><code>addEvent2Q()</code> is a crucial function that manages the proper placement of new events to a person’s event queue. This function is not called directly but is called by the <code>add2Q_XX()</code> family of functions. This function takes two arguments:</p>
<ul>
<li>ixH: index of human</li>
<li>event: a function of the form <code>event_XX(t, PAR)</code>
</li>
</ul>
<p>Below is a description of how the event queue works and should be followed for any future modules.</p>
<pre><code>addEvent2Q(ixH, event){
  ...
}</code></pre>
</div>
<div id="add2q_xx" class="section level3">
<h3 class="hasAnchor">
<a href="#add2q_xx" class="anchor"></a>add2Q_XX</h3>
<p><code>add2Q_XX()</code> is a generic format for adding event XX to a particular person’s event queue. This generic form is used by all functions of this type and are called when some conditions are met that requires a future event to be queued. The function takes two or three arguments:</p>
<ul>
<li>ixH: index of human</li>
<li>t: time the event will occur</li>
<li>PAR: optional argument of generic event parameters</li>
</ul>
<pre><code>add2Q_XX(ixH, t, PAR){
  addEvent2Q(ixH, event_XX(t, PAR))
}</code></pre>
</div>
<div id="event_xx" class="section level3">
<h3 class="hasAnchor">
<a href="#event_xx" class="anchor"></a>event_XX</h3>
<p><code>event_XX()</code> is a generic format for an event. This function is a wrapper that creates a list structure that describes a single event which is placed into a person’s event queue by <code>addEvent2Q()</code>. This list will lie dormant in the event queue until it the event occurs. The function takes one or two arguments:</p>
<ul>
<li>t: time the event will occur</li>
<li>PAR: optional argument of generic event parameters</li>
</ul>
<p>It is important that the list returned by this function exactly match the format below as this is the object that will enter the person’s event queue and will determine how the event will occur at the appropriate time. The named list has four named slots:</p>
<ul>
<li>t: time the event will occur</li>
<li>PAR: event parameters (if no parameters needed, set to NULL)</li>
<li>F: a function of the form F(ixH, t, PAR) that will execute the event</li>
<li>tag: string of the event name (used for fast lookup)</li>
</ul>
<pre><code>event_XX(t, PAR){
  list(t = t, PAR = PAR, F = XX, tag = "XX")
}</code></pre>
</div>
<div id="xx" class="section level3">
<h3 class="hasAnchor">
<a href="#xx" class="anchor"></a>XX</h3>
<p><code>XX()</code> is a generic format for the actual event. This function is called from the main human event queue simulation through <code>runHumanEventQ</code>. This function may directly modify the human object that it is acting upon, and may itself queue up more events. It takes three arguments:</p>
<ul>
<li>ixH: index of human</li>
<li>t: time the event will occur</li>
<li>PAR: generic event parameters</li>
</ul>
<pre><code>XX(ixH, t, PAR){
  # preform arbitrary number of operations on human ixH
  # may itself call functions of add2Q_XX family
}</code></pre>
</div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>The following is an example of how the various event queue functions work together, taken from the PfSI module. Points of interest:</p>
<ul>
<li>
<code>simbite_PfSI()</code>, the equivalent of <code>XX()</code> in the generic family is able to queue multiple future events from itself.</li>
<li>
<code>add2Q_startPfSI()</code> shows the versatility of the PAR argument; virtually any object can be passed in the third slot because it is not directly handled by <code>addEvent2Q()</code> as long as PAR is appropriately handled by other functions in the event family.</li>
</ul>
<pre><code>add2Q_startPfSI &lt;- function(ixH, t, pfid){
  addEvent2Q(ixH, event_startPfSI(t, pfid))
}

event_startPfSI &lt;- function(t, pfid){
  #if(NOISY == TRUE) {print(c(t=t,"adding infection")); browser()}
  if(NOISY == TRUE) {print(c(t=t,"adding infection"))}
  list(t=t, PAR=pfid, F=infectHuman_PfSI, tag="infectHuman_PfSI")
}

infectHuman_PfSI &lt;- function(ixH, t, pfid){
  if(NOISY == TRUE){print("infectHuman")}
  #Infect
  if(HUMANS[[ixH]]$Pathogens$Pf$infected == FALSE &amp; HUMANS[[ixH]]$Pathogens$Pf$chemoprophylaxis == FALSE){
      if(NOISY==TRUE) print("Infect")
      PfSIHistory(ixH, t, "I")
      HUMANS[[ixH]]$Pathogens$Pf$infected &lt;&lt;- TRUE
      HUMANS[[ixH]]$Pathogens$Pf$t0 &lt;&lt;- t
      HUMANS[[ixH]]$Pathogens$Pf$pfid &lt;&lt;- pfid
      if(rbinom(1,1,FeverPf)){
        add2Q_feverPfSI(ixH, t)
      }
      add2Q_endPfSI(ixH, t, pfid)
    }
}</code></pre>
</div>
</div>
<div id="human-object" class="section level1">
<h1 class="hasAnchor">
<a href="#human-object" class="anchor"></a>Human Object</h1>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#event-queue">Event Queue</a><ul class="nav nav-pills nav-stacked">
<li><a href="#event-queue-management">Event Queue Management</a></li>
      <li><a href="#example">Example</a></li>
      </ul>
</li>
      <li><a href="#human-object">Human Object</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by David L. Smith, Héctor Manuel Sánchez Castellanos, Sean Wu, Robert C. Reiner, Jr., Amit Verma.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
